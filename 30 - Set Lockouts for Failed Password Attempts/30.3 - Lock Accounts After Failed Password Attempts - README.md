## 1. Enable feature with faillock
    $ sudo authselect enable-feature with-faillock

## 2. Apply changes
    $ sudo authselect apply-changes -b

## 3. checks for specific PAM (Pluggable Authentication Module) configuration
  #### 3.1 Check if pam_faillock.so lines are present at "/etc/pam.d/system-auth" "/etc/pam.d/password-auth"
    $ sudo grep -E '^\s*auth\s+required\s+pam_faillock\.so\s+(preauth silent|authfail).*$' /etc/pam.d/system-auth /etc/pam.d/password-auth

  #### 3.2 If not found,
    $ sudo sed -i --follow-symlinks '/^auth.*sufficient.*pam_unix\.so.*/i auth        required      pam_faillock.so preauth silent' /etc/pam.d/system-auth 
    $ sudo sed -i --follow-symlinks '/^auth.*sufficient.*pam_unix\.so.*/i auth        required      pam_faillock.so preauth silent' /etc/pam.d/password-auth
    
    $ sudo sed -i --follow-symlinks '/^auth.*required.*pam_deny\.so.*/i auth        required      pam_faillock.so authfail' /etc/pam.d/system-auth
    $ sudo sed -i --follow-symlinks '/^auth.*required.*pam_deny\.so.*/i auth        required      pam_faillock.so authfail' /etc/pam.d/password-auth
    
    $ sudo sed -i --follow-symlinks '/^account.*required.*pam_unix\.so.*/i account     required      pam_faillock.so' /etc/pam.d/system-auth
    $ sudo sed -i --follow-symlinks '/^account.*required.*pam_unix\.so.*/i account     required      pam_faillock.so' /etc/pam.d/password-auth

## 4. Change [default=die] to required in /etc/pam.d/system-auth and /etc/pam.d/password-auth files
      $ sudo sed -Ei 's/(auth.*)(\[default=die\])(.*pam_faillock\.so)/\1required     \3/g' "$pam_file" /etc/pam.d/system-auth
      $ sudo sed -Ei 's/(auth.*)(\[default=die\])(.*pam_faillock\.so)/\1required     \3/g' "$pam_file" /etc/pam.d/password-auth

## 5. Search /etc/security/faillock.conf
  #### 5.1 find /etc/security/faillock.conf
      $ find /etc/security/faillock.conf 

  #### 5.2 If found, Check if the line containing the deny configuration exists
      $ sudo grep '^\s*deny\s*=' /etc/security/faillock.conf 

  #### 5.3 If not found the line containing the deny configuration (append line)
      $ echo 'deny = 5' | sudo tee -a /etc/security/faillock.conf 

  #### 5.4 If found, replace the existing value with the new one
      $ sudo sed -i --follow-symlinks 's|^\s*\(deny\s*=\s*\)\(\S\+\)|\1'5'|g' /etc/security/faillock.conf

